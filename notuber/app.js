function placeMarker(e,n,o){return new google.maps.Marker({position:e,map:n,icon:o})}function getDistance(e,n){return 621371e-9*google.maps.geometry.spherical.computeDistanceBetween(n,e)}function getClosest(e,n){return e[n.indexOf(Math.min(...n))]}function makeRoute(e,n,o){new google.maps.Polyline({path:[{lat:e.lat(),lng:e.lng()},{lat:n.lat(),lng:n.lng()}],geodesic:!0,strokeColor:"#FF0000",strokeOpacity:1,strokeWeight:2}).setMap(o)}function makeMeInfoWindow(e,n,o){new google.maps.InfoWindow({content:'<div id="infoWindow"> <h1>You are here!</h1><p> Closest car ID: '+n.username+"</p><p> Distance from you: "+o.toFixed(2)+" miles </p></div>"}).open(map,e)}function makeCarInfoWindow(e,n){new google.maps.InfoWindow({content:'<div id="infoWindow"><p> Car ID: '+e.username+"</p><p> Distance from you: "+n.toFixed(2)+" miles </p></div>"}).open(map,e.marker)}function initMap(){var e=new google.maps.Map(document.getElementById("map"),{center:{lat:42.352271,lng:-71.055242},zoom:7}),n={url:"car.png",scaledSize:new google.maps.Size(15,35)};navigator.geolocation.getCurrentPosition(function(o){myPos=new google.maps.LatLng(o.coords.latitude,o.coords.longitude);var t=placeMarker(myPos,e),a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==this.readyState&&200==this.status){var o=JSON.parse(this.responseText),a=new Array(o.length);for(let t=0;t<o.length;t++)o[t].latLng=new google.maps.LatLng(o[t].lat,o[t].lng),o[t].marker=placeMarker(o[t].latLng,e,n),a[t]=getDistance(myPos,o[t].latLng),o[t].marker.addListener("click",function(){console.log(o[t]),makeCarInfoWindow(o[t],a[t])});var i=a.indexOf(Math.min(...a));t.addListener("click",function(){makeRoute(myPos,o[i].latLng,e),makeMeInfoWindow(t,o[i],a[i])})}},a.open("POST","https://damp-escarpment-52268.herokuapp.com/rides",!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send("username=jNtRRJiZ&lat="+myPos.lat()+"&lng="+myPos.lng())})}
